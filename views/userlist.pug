doctype html
html(lang='en')
  head
    meta(charset='UTF-8')
    meta(http-equiv='X-UA-Compatible', content='IE=edge')
    meta(name='viewport', content='width=device-width, initial-scale=1.0')
    link(rel='stylesheet', type='text/css', href='https://cdn.datatables.net/1.12.1/css/jquery.dataTables.css')
    link(href='https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css', rel='stylesheet')
    link(rel='stylesheet', href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css')
    link(rel='stylesheet', href='./css/main.css')
    title Admin Dashboard
  body
    #wrapper.d-flex
      // Sidebar
      #sidebar-wrapper.bg-white
        .sidebar-heading.text-center.py-4.primary-text.fs-4.fw-bold.text-uppercase.border-bottom
          i.fas.fa-user-secret.me-2
          | EMS
        .list-group.list-group-flush.my-3
          a.list-group-item.list-group-item-action.bg-transparent.second-text.active(href='rola')
            i.fas.fa-tachometer-alt.me-2
            | UserList
          a.list-group-item.list-group-item-action.bg-transparent.second-text.fw-bold(href='moto')
            i.fas.fa-project-diagram.me-2
            | Role
          a.list-group-item.list-group-item-action.bg-transparent.text-danger.fw-bold(href='#')
            i.fas.fa-power-off.me-2
            | Logout
      // /#sidebar-wrapper
      // Page Content
      #page-content-wrapper
        nav.navbar.navbar-expand-lg.navbar-light.bg-transparent.py-4.px-4
          .d-flex.align-items-center
            i#menu-toggle.fas.fa-align-left.primary-text.fs-4.me-3
            h2.fs-2.m-0 Dashboard
          // Button trigger modal
          button#btn.btn.btn-primary(type='button', data-target='#exampleModal')
            | Add New Userlist
          // Modal
          #goal.modal(tabindex='-1', role='dialog', aria-labelledby='exampleModalLabel', aria-hidden='true')
            .modal-dialog(role='document')
              .modal-content
                .modal-header
                  h5#exampleModalLabel.modal-title Create New UserList
                  button#close.close(type='button', aria-label='Close')
                    span(aria-hidden='true') &times;
                .modal-body
                  form#forms.text-center(action='/rola',method="post",autocomplete='off')
                    .form-group.d-flex.pb-2 
                      input#format(type="hidden" name="format" )
                      input#ids(type="hidden" name="ids")
                      label.mt-2(for='Name') FirstName  
                      input#fl.w-50.form-control(type='text',name='fname',placeholder='First Name')
                    .form-group.d-flex.pb-2 
                      label.mt-2(for='Name') LastName  
                      input#lname.w-50.form-control(type='text',name='lname',placeholder='Last Name')  
                    .form-group.d-flex.pb-2
                      label.mt-2(for="role")  Role
                      select#roles.w-50(name='role')
                        option#role(value="") Enter your Role
                        each x in passed 
                            option(value= x.Role) #{x.Role}
                    .form-group.d-flex.pb-2 
                      label.mt-2(for='Email') Email
                      input#Email.w-50.form-control.mx-auto(type='Email',name='mail' ,placeholder='Your Email ID')

                    .form-group.d-flex.pb-2 
                      label.mt-2(for='PhoneNo') PhoneNo
                      input#phones.w-50.form-control.io(type='tel',name='phoneno', placeholder='Your Mobile No',minlength='10',maxlength='10' required)
                    .form-group.d-flex.pb-2 
                      label.mt-2(for='locate') Location
                      input#locate.w-50.form-control.oo(type='text',name='city', placeholder='Your Location')
                    .modal-footer
                    button.btn.btn-primary.reload(type='submit') Submit
        
          button.navbar-toggler(type='button', data-bs-toggle='collapse', data-bs-target='#navbarSupportedContent', aria-controls='navbarSupportedContent', aria-expanded='false', aria-label='Toggle navigation')
            span.navbar-toggler-icon
          #navbarSupportedContent.collapse.navbar-collapse
            ul.navbar-nav.ms-auto.mb-2.mb-lg-0
              li.nav-item.dropdown
                a#navbarDropdown.nav-link.dropdown-toggle.second-text.fw-bold(href='#', role='button', data-bs-toggle='dropdown', aria-expanded='false')
                  i.fas.fa-user.me-2
                  | Admin
                ul.dropdown-menu(aria-labelledby='navbarDropdown')
                  li
                    a.dropdown-item(href='#') Profile
                  li
                    a.dropdown-item(href='#') Settings
                  li
                    a.dropdown-item(href='/login') Logout
        .container-fluid.px-4
          .row.my-5
            .col
              table#example.display(style='width:100%;')
              thead
                id
                FirstName
                LastName
                Role
                E-MailId
                Phone:No
                Location
              tbody



    // JavaScript Bundle with Popper
    script(src='https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js', integrity='sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3', crossorigin='anonymous')
    script(src='https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js')
    script(type='text/javascript', charset='utf8', src='https://cdn.datatables.net/1.12.1/js/jquery.dataTables.js')
    
    
    
    
    script.
        let el = document.getElementById("wrapper");
        let toggleButton = document.getElementById("menu-toggle");
        toggleButton.onclick = function () {
        el.classList.toggle("toggled");
        };


        $("#btn").on('click',(()=>{
        $("#goal").modal('show')
        }));
        $(".close").on("click",(()=>{
        $("#goal").modal("hide")
        }))
        $('.reload').click(()=>{
          $("#goal").modal("hide")
          $('#example').DataTable().ajax.reload(null,false);
        })
         function EditWindow(){
          $('.modal-title').text('Edit')
          $('.reload').text('Save')
          $('#format').val('EDIT');
          $("#goal").modal('show')  
          }

        
        function deletebyid(id){
           if(confirm('Are you want to delete'))
             $.ajax({
               type: "post",
               url:'/deleteData/:id',
               data:{
                id: id
               },
               dataType:'json',
               
             }).reload()
             else
               $('#example').ajax.reload();  
            }


        $(document).ready(function () {
         let requestUrl = "http://localhost:3000/roladata";
         $('#example').DataTable({
          ajax: {
              url: requestUrl,
              dataSrc: "",  
              },
              "columns": [
              { "title": "Id", "data": "id" },
              { "title": "FirstName", "data": "FirstName" },
              { "title": "LastName", "data": "LastName" },
              { "title": "Role", "data": "Role" },
              { "title": "E-Mail", "data": "E_MailId" },
              { "title": "Phone_NO", "data": "PhoneNo" },
              { "title": "Location", "data": "Location" },
              { "title":  "Edit","data": "id",
                 render:((data)=>{
                  return '<button class="btn btn-warning btn-sm cool" onclick="userbyid(\''+ data +'\');">Edit</button>'})},
              { "title":  "Delete","data": "id",
                 render:((data)=>{
                  return '<button class="btn btn-danger btn-sm " onclick="deletebyid(\''+ data +'\');">Delete</button>'})},
              ]      
              }).reload()
          })
            function userbyid(id){
              
              $.ajax({
                  url: '/edit/:id',
                  data: { id: id },
                  method: "post",
                  dataType: "json",
                  success: function (result) {
                  EditWindow()
                  console.log(result)
                  $('#ids').val(result.id);
                  $('#fl').val(result.FirstName);
                  $('#lname').val(result.LastName);
                  $('#roles').val(result.Role);
                  $('#Email').val(result.E_MailId);
                  $('#phones').val(result.PhoneNo);
                  $('#locate').val(result.Location);
               },
               error:((err)=>{
                    console.log(err)
               })
             })
            }

           




